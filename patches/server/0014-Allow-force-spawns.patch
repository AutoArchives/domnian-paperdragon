From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Fri, 26 Jul 2013 22:19:29 -0400
Subject: [PATCH] Allow force spawns

Pass spawn reason force to not allow plugins to block
Force some cases where plugins should not be allowed to block it.

diff --git a/src/main/java/net/minecraft/server/level/ServerLevel.java b/src/main/java/net/minecraft/server/level/ServerLevel.java
index 4dbe06944edbaa2bb375a1c9b57dfca2023cb31e..03664ed35fe6b1425780481b14807c6e0ce16501 100644
--- a/src/main/java/net/minecraft/server/level/ServerLevel.java
+++ b/src/main/java/net/minecraft/server/level/ServerLevel.java
@@ -1335,7 +1335,7 @@ public class ServerLevel extends Level implements WorldGenLevel {
 
     public void addDuringTeleport(Entity entity) {
         // CraftBukkit start
-        this.addDuringTeleport(entity, CreatureSpawnEvent.SpawnReason.DEFAULT);
+        this.addDuringTeleport(entity, org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason.FORCE); // PaperDragon
     }
 
     public void addDuringTeleport(Entity entity, CreatureSpawnEvent.SpawnReason reason) {
diff --git a/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java b/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java
index ec3f4813bd2a7755f0aa5d870e19dc43fec76fe9..aa6d95d05685a4df5e862e35c64dca5c0bf30ce6 100644
--- a/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java
+++ b/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java
@@ -702,7 +702,7 @@ public class CraftEventFactory {
             event = CraftEventFactory.callEntitySpawnEvent(entity);
         }
 
-        if (event != null && (event.isCancelled() || entity.isRemoved())) {
+        if (spawnReason != SpawnReason.FORCE && event != null && (event.isCancelled() || entity.isRemoved())) { // PaperDragon - add != force
             Entity vehicle = entity.getVehicle();
             if (vehicle != null) {
                 vehicle.discard();
