From 091daa7701688e47fbd688ec0014e404feac685a Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Sun, 17 May 2015 13:38:54 -0400
Subject: [PATCH] Implement SpongeAbsorbEvent

---
 .../com/domnian/paperdragon/PDEventFactory.java   | 15 +++++++++++++++
 .../java/net/minecraft/server/BlockSponge.java    |  5 +++++
 2 files changed, 20 insertions(+)

diff --git a/src/main/java/com/domnian/paperdragon/PDEventFactory.java b/src/main/java/com/domnian/paperdragon/PDEventFactory.java
index ee6012e49..24cc29dac 100644
--- a/src/main/java/com/domnian/paperdragon/PDEventFactory.java
+++ b/src/main/java/com/domnian/paperdragon/PDEventFactory.java
@@ -1,10 +1,15 @@
 package com.domnian.paperdragon;
 
 import com.domnian.paperdragon.events.PlayerHitPlayerEvent;
+import net.minecraft.server.BlockPosition;
 import net.minecraft.server.Entity;
 import net.minecraft.server.EntityPlayer;
+import org.bukkit.Bukkit;
+import org.bukkit.block.Block;
+import org.bukkit.craftbukkit.CraftWorld;
 import org.bukkit.craftbukkit.entity.CraftPlayer;
 import org.bukkit.entity.Player;
+import org.bukkit.event.block.SpongeAbsorbEvent;
 import org.bukkit.inventory.ItemStack;
 
 public class PDEventFactory {
@@ -18,4 +23,14 @@ public class PDEventFactory {
         }
     }
 
+    public static SpongeAbsorbEvent handleSpongeAbsorbEvent(CraftWorld world, BlockPosition spongePosition,
+                                                            BlockPosition absorbedPosition,
+                                                            int absorbtionLevel) {
+        final Block spongeBlock = world.getBlockAt(spongePosition.getX(), spongePosition.getY(), spongePosition.getZ());
+        final Block absorbedBlock = world.getBlockAt(absorbedPosition.getX(), absorbedPosition.getY(), absorbedPosition.getZ());
+        SpongeAbsorbEvent event = new SpongeAbsorbEvent(spongeBlock, absorbedBlock, absorbtionLevel);
+        event.callEvent();
+        return event;
+    }
+
 }
diff --git a/src/main/java/net/minecraft/server/BlockSponge.java b/src/main/java/net/minecraft/server/BlockSponge.java
index 5c5204564..b99f48ef0 100644
--- a/src/main/java/net/minecraft/server/BlockSponge.java
+++ b/src/main/java/net/minecraft/server/BlockSponge.java
@@ -62,6 +62,11 @@ public class BlockSponge extends Block {
                 BlockPosition blockposition2 = blockposition1.shift(enumdirection);
 
                 if (world.getType(blockposition2).getMaterial() == Material.WATER) {
+                    // PaperDragon start
+                    if (com.domnian.paperdragon.PDEventFactory.handleSpongeAbsorbEvent(world.getWorld(), blockposition, blockposition2, j).isCancelled()) {
+                        continue;
+                    }
+                    // PaperDragon end
                     world.setTypeAndData(blockposition2, Blocks.AIR.getBlockData(), 2);
                     arraylist.add(blockposition2);
                     ++i;
-- 
2.17.0

