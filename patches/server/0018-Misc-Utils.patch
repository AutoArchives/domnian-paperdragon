From 0e6a83bca0a43fa5975c350f0f7ea6012d8c4ad5 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Wed, 12 Mar 2014 21:29:01 -0400
Subject: [PATCH] Misc Utils

Adds Misc Util functions to be used by future commits
---
 .../java/com/domnian/paperdragon/CBMiscUtils.java  | 33 ++++++++++++++++++++++
 .../java/org/bukkit/craftbukkit/CraftServer.java   |  1 +
 2 files changed, 34 insertions(+)
 create mode 100644 src/main/java/com/domnian/paperdragon/CBMiscUtils.java

diff --git a/src/main/java/com/domnian/paperdragon/CBMiscUtils.java b/src/main/java/com/domnian/paperdragon/CBMiscUtils.java
new file mode 100644
index 0000000..9ac4b8f
--- /dev/null
+++ b/src/main/java/com/domnian/paperdragon/CBMiscUtils.java
@@ -0,0 +1,33 @@
+package com.domnian.paperdragon;
+
+import net.minecraft.server.ItemMonsterEgg;
+import org.apache.commons.lang.exception.ExceptionUtils;
+import org.bukkit.Bukkit;
+import org.bukkit.Material;
+import org.bukkit.World;
+import org.bukkit.craftbukkit.inventory.CraftItemStack;
+import org.bukkit.entity.EntityType;
+
+public final class CBMiscUtils {
+    private CBMiscUtils() {}
+
+    public static EntityType getTypeForSpawnEgg(org.bukkit.inventory.ItemStack bukkitItem) {
+        if (bukkitItem.getType() != Material.MONSTER_EGG) {
+            return null;
+        }
+        net.minecraft.server.ItemStack item = CraftItemStack.asNMSCopy(bukkitItem);
+        return EntityType.fromName(ItemMonsterEgg.h(item));
+    }
+
+    public static void clearEntityMeta() {
+        for (World world : Bukkit.getWorlds()) {
+            for (org.bukkit.entity.Entity entity : world.getEntities()) {
+                entity.getTempMeta().clear();
+            }
+        }
+    }
+
+    public static String stack() {
+        return ExceptionUtils.getFullStackTrace(new Throwable());
+    }
+}
diff --git a/src/main/java/org/bukkit/craftbukkit/CraftServer.java b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
index f199767..4ab3662 100644
--- a/src/main/java/org/bukkit/craftbukkit/CraftServer.java
+++ b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
@@ -774,6 +774,7 @@ public final class CraftServer implements Server {
                 "This plugin is not properly shutting down its async tasks when it is being reloaded.  This may cause conflicts with the newly loaded version of the plugin"
             ));
         }
+        com.domnian.paperdragon.CBMiscUtils.clearEntityMeta(); // PaperDragon - Import Patch From EMC
         net.minecraft.server.EntityTasksHandler.reload(); // PaperDragon - Import Patch From EMC
         loadPlugins();
         enablePlugins(PluginLoadOrder.STARTUP);
-- 
2.5.0

