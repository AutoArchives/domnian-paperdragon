From dab491ccb09aea750cd93ab5d76c64414e1b0b35 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Sat, 28 Dec 2013 21:17:45 -0500
Subject: [PATCH] Block EnderPearl Travel exploit

---
 src/main/java/com/domnian/paperdragon/DragonConfig.java  | 6 ++++++
 src/main/java/net/minecraft/server/EntityProjectile.java | 1 +
 2 files changed, 7 insertions(+)

diff --git a/src/main/java/com/domnian/paperdragon/DragonConfig.java b/src/main/java/com/domnian/paperdragon/DragonConfig.java
index 6d129abae..b75e1c92b 100644
--- a/src/main/java/com/domnian/paperdragon/DragonConfig.java
+++ b/src/main/java/com/domnian/paperdragon/DragonConfig.java
@@ -162,6 +162,12 @@ public class DragonConfig {
         hiddenItemMetaTagMeta = getString("settings.hidden-item-meta.meta-tag", "&&::META");
         hiddenItemMetaTagShiny = getString("settings.hidden-item-meta.shiny-tag", "&&::SHINY");
     }
+
+    public static boolean blockEnderpearlTravelExploit = false;
+    private static void expoits() {
+        blockEnderpearlTravelExploit = getBoolean("settings.block-enderpearl-travel-exploit", blockEnderpearlTravelExploit);
+    }
+
     // TODO Add New Settings!! :D
 
 }
diff --git a/src/main/java/net/minecraft/server/EntityProjectile.java b/src/main/java/net/minecraft/server/EntityProjectile.java
index dd8af4be8..75e25f9f3 100644
--- a/src/main/java/net/minecraft/server/EntityProjectile.java
+++ b/src/main/java/net/minecraft/server/EntityProjectile.java
@@ -239,6 +239,7 @@ public abstract class EntityProjectile extends Entity implements IProjectile {
         this.shake = nbttagcompound.getByte("shake") & 255;
         this.inGround = nbttagcompound.getByte("inGround") == 1;
         this.shooter = null;
+        if (this instanceof EntityEnderPearl && com.domnian.paperdragon.DragonConfig.blockEnderpearlTravelExploit) return; // PaperDragon - Chunk reloads should not keep owner
         if (nbttagcompound.hasKeyOfType("owner", 10)) {
             this.shooterId = GameProfileSerializer.b(nbttagcompound.getCompound("owner"));
         }
-- 
2.18.0

