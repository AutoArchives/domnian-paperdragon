From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: chickeneer <emcchickeneer@gmail.com>
Date: Sat, 6 Jun 2020 21:17:28 -0500
Subject: [PATCH] Raid total waves API


diff --git a/src/main/java/net/minecraft/world/entity/raid/Raid.java b/src/main/java/net/minecraft/world/entity/raid/Raid.java
index f50abfd058e3adf1cf8c0f4468a60bc04e8541e7..784c57d2bbbdfab2c297da0f4b7356bd47a59e81 100644
--- a/src/main/java/net/minecraft/world/entity/raid/Raid.java
+++ b/src/main/java/net/minecraft/world/entity/raid/Raid.java
@@ -103,7 +103,8 @@ public class Raid {
     private int postRaidTicks;
     private int raidCooldownTicks;
     private final Random random;
-    public final int numGroups;
+    public int numGroups; // PaperDragon - make non-final
+    public boolean firstTrigger = false; // PaperDragon
     private Raid.RaidStatus status;
     private int celebrationTicks;
     private Optional<BlockPos> waveSpawnPos;
@@ -120,6 +121,7 @@ public class Raid {
         this.center = pos;
         this.numGroups = this.getNumGroups(world.getDifficulty());
         this.status = Raid.RaidStatus.ONGOING;
+        this.firstTrigger = true; // PaperDragon
     }
 
     public Raid(ServerLevel world, CompoundTag nbt) {
diff --git a/src/main/java/net/minecraft/world/entity/raid/Raids.java b/src/main/java/net/minecraft/world/entity/raid/Raids.java
index 17b24f57cc5d63f99eb999cfe3e2362758fe0f4f..679f27bb6757e3335aa6fcb202e116bef5708362 100644
--- a/src/main/java/net/minecraft/world/entity/raid/Raids.java
+++ b/src/main/java/net/minecraft/world/entity/raid/Raids.java
@@ -133,6 +133,7 @@ public class Raids extends SavedData {
                         return null;
                     }
 
+                    raid.firstTrigger = false; // PaperDragon
                     if (!this.raidMap.containsKey(raid.getId())) {
                         this.raidMap.put(raid.getId(), raid);
                     }
diff --git a/src/main/java/org/bukkit/craftbukkit/CraftRaid.java b/src/main/java/org/bukkit/craftbukkit/CraftRaid.java
index 7a5bfc724e42100b7582836ab8c30feed1a3d221..b29620edac4e9a7a57fe5d8c75e6b78aebeafa0a 100644
--- a/src/main/java/org/bukkit/craftbukkit/CraftRaid.java
+++ b/src/main/java/org/bukkit/craftbukkit/CraftRaid.java
@@ -79,6 +79,13 @@ public final class CraftRaid implements Raid {
         return handle.numGroups;
     }
 
+    // PaperDragon start
+    @Override
+    public void setTotalWaves(int total) {
+        Preconditions.checkArgument(1 <= total && total <= 7, "Total waves out of bounds 1 <= %s <= 7", total);
+        handle.numGroups = total;
+    }
+    // PaperDragon end
     @Override
     public float getTotalHealth() {
         return this.handle.getHealthOfLivingRaiders();
diff --git a/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java b/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java
index 1dc8ad6149f317af81f0f2a4102bb1ad2d864d1c..c31b6f8158f775515f5a2109da6342f519d16a20 100644
--- a/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java
+++ b/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java
@@ -1837,7 +1837,7 @@ public class CraftEventFactory {
      * Raid events
      */
     public static boolean callRaidTriggerEvent(Raid raid, ServerPlayer player) {
-        RaidTriggerEvent event = new RaidTriggerEvent(new CraftRaid(raid), raid.getLevel().getWorld(), player.getBukkitEntity());
+        RaidTriggerEvent event = new RaidTriggerEvent(new CraftRaid(raid), raid.getLevel().getWorld(), player.getBukkitEntity(), raid.firstTrigger); // PaperDragon - add raid.firstTrigger
         Bukkit.getPluginManager().callEvent(event);
         return !event.isCancelled();
     }
