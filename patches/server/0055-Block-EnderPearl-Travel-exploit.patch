From 73a39ef027ef726bfeb5029f5c0e37832cdb02ad Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Sat, 28 Dec 2013 21:17:45 -0500
Subject: [PATCH] Block EnderPearl Travel exploit

---
 src/main/java/com/domnian/paperdragon/DragonConfig.java  | 5 +++++
 src/main/java/net/minecraft/server/EntityProjectile.java | 1 +
 2 files changed, 6 insertions(+)

diff --git a/src/main/java/com/domnian/paperdragon/DragonConfig.java b/src/main/java/com/domnian/paperdragon/DragonConfig.java
index 96643461e..b339651e9 100644
--- a/src/main/java/com/domnian/paperdragon/DragonConfig.java
+++ b/src/main/java/com/domnian/paperdragon/DragonConfig.java
@@ -170,6 +170,11 @@ public class DragonConfig {
     private static void requiredPlugins() {
         requiredPlugins = getList("settings.required-plugins", requiredPlugins);
     }
+
+    public static boolean blockEnderpearlTravelExploit = false;
+    private static void expoits() {
+        blockEnderpearlTravelExploit = getBoolean("settings.block-enderpearl-travel-exploit", blockEnderpearlTravelExploit);
+    }
     // TODO Add New Settings!! :D
 
 }
diff --git a/src/main/java/net/minecraft/server/EntityProjectile.java b/src/main/java/net/minecraft/server/EntityProjectile.java
index 18d28a151..0652e56fa 100644
--- a/src/main/java/net/minecraft/server/EntityProjectile.java
+++ b/src/main/java/net/minecraft/server/EntityProjectile.java
@@ -202,6 +202,7 @@ public abstract class EntityProjectile extends Entity implements IProjectile {
         this.shake = nbttagcompound.getByte("shake") & 255;
         this.inGround = nbttagcompound.getByte("inGround") == 1;
         this.shooter = null;
+        if (this instanceof EntityEnderPearl && com.domnian.paperdragon.DragonConfig.blockEnderpearlTravelExploit) return; // PaperDragon - Chunk reloads should not keep owner
         if (nbttagcompound.hasKeyOfType("owner", 10)) {
             this.shooterId = GameProfileSerializer.b(nbttagcompound.getCompound("owner"));
         }
-- 
2.17.1

