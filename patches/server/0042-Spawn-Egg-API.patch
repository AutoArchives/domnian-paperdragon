From 3e295a28ee113642141e6377224856ed588d799a Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Sat, 3 Dec 2016 22:23:55 -0500
Subject: [PATCH] Spawn Egg API

---
 .../paperdragon/api/CraftDAPI_Misc.java       | 64 +++++++++++++------
 1 file changed, 43 insertions(+), 21 deletions(-)

diff --git a/src/main/java/com/domnian/paperdragon/api/CraftDAPI_Misc.java b/src/main/java/com/domnian/paperdragon/api/CraftDAPI_Misc.java
index 17c3191d4..1f19453f9 100644
--- a/src/main/java/com/domnian/paperdragon/api/CraftDAPI_Misc.java
+++ b/src/main/java/com/domnian/paperdragon/api/CraftDAPI_Misc.java
@@ -8,26 +8,6 @@
  *  without limitation the rights to use, copy, modify, merge, publish,
  *  distribute, sublicense, and/or sell copies of the Software, and to
  *  permit persons to whom the Software is furnished to do so, subject to
-||||||| expected
-import net.minecraft.server.ItemWorldMap;
-import net.minecraft.server.MCUtil;
-import net.minecraft.server.MapIcon;
-import net.minecraft.server.MapIcon.Type;
-import net.minecraft.server.MinecraftKey;
-import net.minecraft.server.NBTTagCompound;
-import net.minecraft.server.World;
-import net.minecraft.server.WorldMap;
-=======
-import net.minecraft.server.ItemWorldMap;
-import net.minecraft.server.MCUtil;
-import net.minecraft.server.MapIcon.Type;
-import net.minecraft.server.MinecraftKey;
-import net.minecraft.server.NBTTagCompound;
-import net.minecraft.server.NBTTagList;
-import net.minecraft.server.ThreadWatchdog;
-import net.minecraft.server.World;
-import net.minecraft.server.WorldMap;
->>>>>>> replacement
  *  the following conditions:
  *
  *  The above copyright notice and this permission notice shall be
@@ -40,15 +20,18 @@ import net.minecraft.server.WorldMap;
  *  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
  *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
  *  WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-<<<<<<< found
  */
 
 package com.domnian.paperdragon.api;
 
+import net.minecraft.server.ItemMonsterEgg;
+import net.minecraft.server.MinecraftKey;
 import net.minecraft.server.ItemStack;
 import net.minecraft.server.NBTTagCompound;
+import org.bukkit.Material;
 import net.minecraft.server.NBTTagList;
 import org.bukkit.craftbukkit.inventory.CraftItemStack;
+import org.bukkit.entity.EntityType;
 
 import javax.annotation.Nonnull;
 import java.util.ArrayList;
@@ -56,6 +39,45 @@ import java.util.List;
 
 public class CraftDAPI_Misc implements DAPI_Misc {
 
+    public final EntityType getTypeForSpawnEgg(@Nonnull org.bukkit.inventory.ItemStack bukkitItem) {
+        if (bukkitItem.getType() != Material.MONSTER_EGG) {
+            return null;
+        }
+        MinecraftKey key = ItemMonsterEgg.getKey(CraftItemStack.asNMSCopy(bukkitItem));
+        return key != null ? EntityType.fromName(key.getKey()) : null;
+    }
+
+    public final org.bukkit.inventory.ItemStack spawnEggAsType(@Nonnull org.bukkit.inventory.ItemStack bukkitItem,
+                                                               @Nonnull org.bukkit.NamespacedKey key) {
+        if (bukkitItem.getType() != Material.MONSTER_EGG) {
+            return null;
+        }
+        if (!"minecraft".equals(key.getNamespace())) {
+            throw new IllegalArgumentException("Group of key must be minecraft");
+        }
+        ItemStack item;
+        if (bukkitItem instanceof CraftItemStack && ((CraftItemStack) bukkitItem).handle != null) {
+            item = ((CraftItemStack) bukkitItem).handle;
+        } else {
+            item = CraftItemStack.asNMSCopy(bukkitItem);
+        }
+        if (item == null) {
+            throw new NullPointerException("Could not set type for spawn egg");
+        }
+        if (item.tag == null) {
+            item.tag = new NBTTagCompound();
+        }
+
+        NBTTagCompound nbttagcompound = (NBTTagCompound) item.tag.get("EntityTag");
+        if (nbttagcompound == null) {
+            nbttagcompound = new NBTTagCompound();
+        }
+        nbttagcompound.setString("id", key.toString());
+        item.tag.set("EntityTag", nbttagcompound);
+
+        return CraftItemStack.asCraftMirror(item);
+    }
+
     @Override
     public boolean hasShulkerInventory(@Nonnull org.bukkit.inventory.ItemStack shulker) {
         return getNBTItems(shulker) != null;
-- 
2.17.0

